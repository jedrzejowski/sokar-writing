\label{sec:sokar-scenesets}

Abstrakcyjna klasa \sokarclass{DicomSceneSet} implementuje kolekcje scen.
Jest to obiekt, który grupuje w jakiś sposób sceny a następnie tworzy obiekt \sokarclass{SceneSequence}, który jest rzeczywistą sekwencją scen, ułożoną w taki sposób, jaki obrazy powinny być wyświetlane.
Są dwie implementacje zbioru scen: zbiór plików i zbiór ramek z jednego pliku

\subsection{SceneSequence}

\par
Sekwencja scen implementuje strukturę danych informującą o przejściach pomiędzy scenami poprzez klasę \sokarclass{SceneSequence}.
Sekwencja to wektor zawierającą kroki z dodatkowymi informacjami o stanie sekwencji.
Indeksem w którym obecnie znajduje się sekwencja.
Kierunkiem sekwencji, sekwencja może iść w stronę początku lub koca.
Rodzajem przemiatania, jest to wartość logiczna informująca w jaki sposób ma zachować się gdy sekwencja dojdzie do końca, lub początku.
Po dojściu do końca sekwencja skoczy do pierwszego elementu lub może zmienić kierunek i zacząć iść do tyłu.

\par
Kroki, implementowane, przez klasą \sokarclass{Step}, zawierają następujące informacje: wskaźnik do sceny oraz czas trwania sceny.

\par
Sekwencja ma wbudowane funkcje zapewniające przemieszczanie się:
\begin{itemize}
    \item \sokarfunction{SceneSequence}{stepForward} --- krok do przodu, zwiększa indeks tym samym wykonuje krok w stronę końca sekwencji
    \item \sokarfunction{SceneSequence}{stepBackward} --- krok do tyłu, zmniejsza indeks tym samym wykonując krok w stronę początku sekwencji
    \item \sokarfunction{SceneSequence}{step} --- wykonuje krok w tył lub przód w zależności od kierunku sekwencji
\end{itemize}
Wszystkie powyższe funkcje są zarazem slotami dla sygnałów oraz emitują sygnał \sokarfunction{SceneSequence}{steped}.

\subsection{DicomFrameSet}

\par
Obiekt tej klasy jest tworzony z jednego wczytanego pliku DICOM.
Klasa tworzy obiekt konwertera i pobiera ilość ramek w obrazie.
Tworzy jeden buffor na wszystkie ramki obrazów, a następnie dzieli go na ilość ramek.
Biblioteka GDCM nie daje dostępu do oryginalnego bufora, dlatego wymagany jest bufor pośredni.
Następnie jest tworzonych tyle obiektów scen ile ramek.
\par
Kolejność sekwencja scen jest taka sama jak kolejność ramek.
Natomiast czas wyświetlania ramki może być zapisany w różnych tagach.
To w którym tagu został zapisany informuje element o znaczniku \dicomtag{FrameIncrementPointer}{0028}{0009}, zawiera on wskaźnik do elementu o zadanym znaczniku i w zależności od znacznika.
Została zaimplementowana obsługa poniższy znaczników:
\begin{itemize}
    \item \dicomtag{FrameTime}{0018}{1063} --- element z tym znacznikiem zawiera czas trwania jednej ramki w milisekundach, każdemu krokowi jest przypisywana ta wartość trwania

    \item \dicomtag{FrameTimeVector}{0018}{1065} --- zawiera tablice z przyrostami czasu w milisekundach między n-tą ramką a poprzednią klatką. Pierwsza ramka ma zawsze przyrost czasu równy 0.
    
    \item \dicomtag{CineRate}{0018}{0040} --- zawiera ilość klatek wyświetlanych na sekunda, każdemu krokowi jest przypisywana wartość odwrotna do tej
\end{itemize}
W przypadku braku znacznika lub gdy zostaje wskazany znacznik nieznany, czas trwania ramki wynosi $83.3$ milisekundy, co odpowiada 12 klatką na sekundę.


\subsection{DicomFileSet}
\par
Obiekt tej klasy jest tworzony z wielu wczytanych plików DICOM.
Klasa nie sprawdza czy pliki odstarczone są z tej samej serii, robi to \sokarclass{DicomTabs}, opisany w sekcji \ref{sec:dicom-tabs}.
Na początku pliki są sortowane na posdtawie liczby zawartej w elemencie o znaczniku.
Dla każdego pliku jest tworzony obiekt \sokarclass{DicomFrameSet}.
\par
Sekwencja jest tworzona na połączenie sekwencji poszczególnych obrazów.
