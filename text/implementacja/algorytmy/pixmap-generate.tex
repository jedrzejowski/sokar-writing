

Klasa \sokarclass{DicomScene} jest klasą abstrakcyjną i nie generuje obrazu, pozostawia do klasą dziedziczących po niej.

\subsubsection{Cykl generowania obrazu}

Klasa \sokarclass{DicomScene} dostarcza następujące obiekty do generowania obrazu:
\begin{itemize}
    \item \cppcode{processing}, obiekt klasy \qtclass{QMutex}, muteks do zablokowania podczas generowania obrazu, aby parametry obrazu nie mogły być zmienianie podczas jego generowania.

    \item \cppcode{imgDimX} zmienna typu \cppcode{uint}, oznacza szerokość obrazu w pikselach.

    \item \cppcode{imgDimY} zmienna typu \cppcode{uint}, oznacza wysokość obrazu w pikselach.

    \item \cppcode{targetBuffer} wektor docelowego obrazu RGB o długości $imgDimX*imgDimY$, typu \cppcode{std::vector<Pixel>}.

          \sokarclass{Pixel} to struktura reprezentujące piksel.
          Nie jest to w żadnym wypadku obiekt, a jedynie twór ułatwiający zarządzanie kodem.

          \begin{lstlisting}
struct Pixel {
    quint8 red = 0;   
    quint8 green = 0;    
    quint8 blue = 0;   
}\end{lstlisting}

    \item \cppcode{originBuffer} wektor danych wypełniona danymi z jednej ramki o długośći iloczynu $imgDimX*imgDimY$ i ilości bajtów jednego piksela obrazu.

    \item \cppcode{qImage} obiekt obrazu klasy \qtclass{QImage}.

          \qtclass{QImage} można zrobić z istniejącego bufora, w tym przypadku jest to \cppcode{targetBuffer}.
          Format obrazu to \qtclass{QImage::Format\_RGB888}, czyli trzy bajty, każdy na jeden kanał.
          Proszę zwrócić uwagę, że struktura \sokarclass{Pixel} odpowiada temu formatowi.
          Według dokumentacji Qt obiekt ten po utworzeniu z istniejącego bufora powinien z niego dalej korzystać, dlatego zmiany \cppcode{targetBuffer} nie wymagają odświeżania \cppcode{qImage}.

    \item \cppcode{pixmap} obiekt obrazu do wyświetlania, klasy \qtclass{QPixmap}.

          Obiektów klasy \qtclass{QImage} nie da się wyświetlić, nie jest on przystosowany do wyświetlania.
          Natomiast klasa \qtclass{QPixmap} to reprezentacja obrazu dostosowana do wyświetlania ekranie, która może być używana jako urządzenie do malowania w bibliotece Qt.

    \item \cppcode{iconPixmap} obiekt obrazu ikonu, klasy \qtclass{QPixmap}, docelowo powinien mieć 128 pikseli na 128 pikseli.

\end{itemize}

Generowanie obrazu jest robione przez czysto wirtualną funkcje \sokarfunction{DicomScene}{generatePixmap}.
Po wywołaniu funkcji obiekt \cppcode{targetBuffer} powinien zawierać obraz wygenerowany z obecnymi parametrami.
Funkcja zwraca również wartość logiczną, który informuje nas czy \cppcode{targetBuffer} rzeczywiście został zmieniony.
Następnie z obiekt \cppcode{pixmap} jest odświeżany na bazie \cppcode{qImage}.

Całe odświeżanie obrazu jest implementowane w funkcji \sokarfunction{DicomScene}{reloadPixmap}.
Funkcja wywołuje \sokarfunction{DicomScene}{generatePixmap} i odświeża \cppcode{pixmapItem} kiedy zajdzie taka potrzeba

Generowanie poszczególnych typów obrazów jest wyjaśnione poniżej.


\paragraph{Obraz monochromatyczny}
Obraz monochromatyczny to obraz w odcieniach szarości, od białego do czarnego lub od czarnego do białego.

\paragraph{RGB}
Obrazów zapisanych w RGB nie trzeba w żaden sposób obrabiać, dane już są prawie gotowe do wyświetlenia, należy je tylko odpowiednio posortować, tak jak wymaga biblioteka QT.
Sposób posortowania wartości w pilku określa \dicomtag{PlanarConfiguration}{0x0028}{0006}. Może o przyjąć dwie następujące wartośći:

\begin{itemize}
    \item 0 - oznacza to, że wartości pikseli są ułożone w taki sposób
        \[R1, G1, B1, R2, G2, B2, R3, G3, B3, R4, G4, B4,  ...\]
    \item 1 - oznacza to, że wartości pikseli są ułożone w taki sposób
        \[R1, R2, R3, R4, ... , G1, G2, G3, G4, ..., B1, B2, B3, B4, ...\]
\end{itemize}
gdzie:
\begin{itemize}
    \item Rn --- wartość czerwonego kanału
    \item Gn --- wartość zielonego kanału
    \item Bn --- wartość niebieskiego kanału
\end{itemize}

Wartości obrazu są przepisywane do bufora dla biblioteki QT.


\paragraph{YBR}
