
Klasa \sokarclass{DicomScene} jest klasą abstrakcyjną i nie generuje obrazu, pozostawia do klasą dziedziczących po niej.

\paragraph{Cykl generowania obrazu}

Klasa \sokarclass{DicomScene} dostarcza następujące obiekty do generowania obrazu:
\begin{itemize}
    \item \cppcode{processing}, obiekt klasy \qtclass{QMutex} muteks do zablokowania podczas generowania obrazu, aby parametry obrazu nie mogły być zmienianie podczas jego generowania.

    \item \cppcode{imgDimX} zmienna typu \cppcode{uint}, oznacza szerokość obrazu w pikselach.

    \item \cppcode{imgDimY} zmienna typu \cppcode{uint}, oznacza wysokość obrazu w pikselach.

    \item \cppcode{targetBuffer} wektor docelowego obrazu RGB o długości $imgDimX*imgDimY$, typu \cppcode{std::vector<Pixel>}.

          \sokarclass{Pixel} to struktura reprezentujące piksel.
          Nie jest to w żadnym wypadku obiekt, a jedynie twór ułatwiający zarządzanie kodem.

          \begin{lstlisting}
struct Pixel {
    quint8 red = 0;   
    quint8 green = 0;    
    quint8 blue = 0;   
}\end{lstlisting}

    \item \cppcode{originBuffer} wektor danych wypełniona danymi z jednej ramki o długośći iloczynu $imgDimX*imgDimY$ i ilości bajtów jednego piksela obrazu.

    \item \cppcode{qImage} obiekt obrazu klasy \qtclass{QImage}.

          \qtclass{QImage} można zrobić z istniejącego bufora, w tym przypadku jest to \cppcode{targetBuffer}.
          Format obrazu to \qtclass{QImage::Format\_RGB888}, czyli trzy bajty, każdy na jeden kanał.
          Proszę zwrócić uwagę, że struktura \sokarclass{Pixel} odpowiada temu formatowi.
          Według dokumentacji Qt obiekt ten po utworzeniu z istniejącego bufora powinien z niego dalej korzystać, dlatego zmiany \cppcode{targetBuffer} nie wymagają odświeżania \cppcode{qImage}.

    \item \cppcode{pixmap} obiekt obrazu do wyświetlania, klasy \qtclass{QPixmap}.

          Obiektów klasy \qtclass{QImage} nie da się wyświetlić, nie jest on przystosowany do wyświetlania.
          Natomiast klasa \qtclass{QPixmap} to reprezentacja obrazu dostosowana do wyświetlania ekranie, która może być używana jako urządzenie do malowania w bibliotece Qt.

    \item \cppcode{iconPixmap} obiekt obrazu ikonu, klasy \qtclass{QPixmap}, docelowo powinien mieć 128 pikseli na 128 pikseli.

\end{itemize}

Generowanie obrazu jest robione przez czysto wirtualną funkcje \sokarfunction{DicomScene}{generatePixmap}.
Po wywołaniu funkcji obiekt \cppcode{targetBuffer} powinien zawierać obraz wygenerowany z obecnymi parametrami.
Funkcja zwraca również wartość logiczną, który informuje nas czy \cppcode{targetBuffer} rzeczywiście został zmieniony.
Następnie z obiekt \cppcode{pixmap} jest odświeżany na bazie \cppcode{qImage}.

Całe odświeżanie obrazu jest implementowane w funkcji \sokarfunction{DicomScene}{reloadPixmap}.
Funkcja wywołuje \sokarfunction{DicomScene}{generatePixmap} i odświeża \cppcode{pixmapItem} kiedy zajdzie taka potrzeba

Generowanie poszczególnych typów obrazów jest wyjaśnione poniżej.

\subsubsection{Monochorme}
\input{text/implementacja/pixmap-monochrome.tex}

\subsubsection{RGB}
\input{text/implementacja/pixmap-rgb.tex}

\subsubsection{YBR}
\input{text/implementacja/pixmap-ybr.tex}